define("bundles/item-quiz/components/NewQuizItem",["require","exports","module","classnames","react","bundles/assess/assessmentTypes/phoenixQuiz/assessment","bundles/item/constants/ItemTypes","bundles/item/components/ItemLayout","bundles/item/components/LightItemLayout","bundles/item/utils/itemViewValidator","bundles/phoenix/components/OrigamiRegion","bundles/quiz-common/actions/QuizActions","bundles/quiz/components/TrackedQuiz","bundles/quiz-common/constants/QuizStates","bundles/quiz-common/models/GradingAttempt","pages/open-course/common/models/itemMetadata","pages/open-course/common/utils/lockExperiment","pages/open-course/verification/views/verification","bundles/phoenix/lib/waitForStores"],function(require,exports,module){"use strict";function _defaults(e,o){for(var i=Object.getOwnPropertyNames(o),t=0;t<i.length;t++){var n=i[t],s=Object.getOwnPropertyDescriptor(o,n);s&&s.configurable&&void 0===e[n]&&Object.defineProperty(e,n,s)}return e}function _classCallCheck(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function _possibleConstructorReturn(t,e){if(!t)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return!e||"object"!=typeof e&&"function"!=typeof e?t:e}function _inherits(t,e){if("function"!=typeof e&&null!==e)throw new TypeError("Super expression must either be null or a function, not "+typeof e);t.prototype=Object.create(e&&e.prototype,{constructor:{value:t,enumerable:!1,writable:!0,configurable:!0}}),e&&(Object.setPrototypeOf?Object.setPrototypeOf(t,e):_defaults(t,e))}function _defineProperty(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var c=Object.assign||function(s){for(var e=1;e<arguments.length;e++){var t=arguments[e];for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(s[n]=t[n])}return s},t,o,p,i,u,b=require("classnames"),e=require("react"),w=require("bundles/assess/assessmentTypes/phoenixQuiz/assessment"),v=require("bundles/item/constants/ItemTypes"),P=require("bundles/item/components/ItemLayout"),C=require("bundles/item/components/LightItemLayout"),I=require("bundles/item/utils/itemViewValidator"),f=require("bundles/phoenix/components/OrigamiRegion"),s=require("bundles/quiz-common/actions/QuizActions"),d=s.loadQuiz,g=s.showQuizStart,y=s.verifyQuiz,h=s.attemptQuiz,T=require("bundles/quiz/components/TrackedQuiz"),r=require("bundles/quiz-common/constants/QuizStates"),z=require("bundles/quiz-common/models/GradingAttempt"),m=require("pages/open-course/common/models/itemMetadata"),S=require("pages/open-course/common/utils/lockExperiment"),q=require("pages/open-course/verification/views/verification"),x=require("bundles/phoenix/lib/waitForStores"),l=r.START,a=r.VERIFY,n=r.ATTEMPT,O=(t={},_defineProperty(t,l,w),_defineProperty(t,a,q),_defineProperty(t,n,T),t),M=[a,n],R=[n],j=(p=o=function(t){function QuizItem(){var o,e,i;_classCallCheck(this,QuizItem);for(var r=arguments.length,u=Array(r),s=0;r>s;s++)u[s]=arguments[s];return o=e=_possibleConstructorReturn(this,t.call.apply(t,[this].concat(u))),e.state={stateOptions:{}},e.handleStateChange=function(s){var o=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},t=e.context.executeAction;switch(s){case l:t(g);break;case a:t(y);break;case n:t(h,o);break;default:throw new Error("Unknown quiz state: "+s)}},i=o,_possibleConstructorReturn(e,i)}return _inherits(QuizItem,t),QuizItem.prototype.componentDidMount=function componentDidMount(){var e=this.props,t=e.courseId,n=e.courseMaterials,s=e.courseGrade,o=e.courseProgress;S.setup(t,n,s,o)},QuizItem.prototype.renderView=function renderView(){var s=this.props,t=s.quizState,r=s.contentModel,o=this.state.stateOptions,n=O[t],i=R.includes(t);if(!n)throw new Error("Unknown state: "+t);return e.createElement("div",{className:b("rc-QuizItem",{state:t})},i&&e.createElement(n,c({},this.props,o,{onStateChange:this.handleStateChange})),!i&&e.createElement(f,{ViewClass:n,viewOptions:c({},this.props,o,{model:r,fluxibleContext:this.context.fluxibleContext,onStateChange:this.handleStateChange})}))},QuizItem.prototype.render=function render(){var t=this.props,s=t.itemMetadata,o=t.quizState,i=M.includes(o),n=this.renderView();if(i)return n;return e.createElement(P,null,e.createElement(C,{isCard:!0,itemType:v.Quiz,itemMetadata:s},n))},QuizItem}(e.Component),o.propTypes={itemMetadata:e.PropTypes.instanceOf(m).isRequired,quizState:e.PropTypes.string.isRequired,attemptState:e.PropTypes.string.isRequired,gradingAttempt:e.PropTypes.instanceOf(z),sessionId:e.PropTypes.string,sessionData:e.PropTypes.object,attemptIndex:e.PropTypes.number,verifiableId:e.PropTypes.string,courseId:e.PropTypes.string.isRequired,courseMaterials:e.PropTypes.object.isRequired,courseGrade:e.PropTypes.object.isRequired,courseProgress:e.PropTypes.object.isRequired,verificationDisplay:e.PropTypes.object.isRequired,contentModel:e.PropTypes.object.isRequired,assessmentClient:e.PropTypes.object.isRequired},o.contextTypes={executeAction:e.PropTypes.func.isRequired,fluxibleContext:e.PropTypes.object.isRequired},p),Q=x(["QuizStore","CourseStore","CourseViewGradeStore","VerificationStore"],function(t,i){var e=t.QuizStore,n=t.CourseStore,s=t.CourseViewGradeStore,o=t.VerificationStore;return{quizState:e.getQuizState(),attemptState:e.getAttemptState(),gradingAttempt:e.getGradingAttempt(),sessionId:e.getSessionId(),sessionData:e.getSessionData(),attemptIndex:e.getAttemptIndex(),verifiableId:e.getVerifiableId(),courseId:n.getCourseId(),courseMaterials:n.getMaterials(),courseGrade:s.getCourseViewGrade(),verificationDisplay:o.getVerificationDisplay(),assessmentClient:e.getAssessmentClient(),contentModel:e.getContentModel()}})(j),A=(u=i=function(t){function QuizItemContainer(){return _classCallCheck(this,QuizItemContainer),_possibleConstructorReturn(this,t.apply(this,arguments))}return _inherits(QuizItemContainer,t),QuizItemContainer.prototype.componentDidMount=function componentDidMount(){var e=this.props.itemMetadata;this.context.executeAction(d,{itemMetadata:e})},QuizItemContainer.prototype.render=function render(){return e.createElement(Q,this.props)},QuizItemContainer}(e.Component),i.propTypes={itemMetadata:e.PropTypes.instanceOf(m).isRequired},i.contextTypes={executeAction:e.PropTypes.func.isRequired},u);module.exports=I(A,{renderItemLayout:!0})});